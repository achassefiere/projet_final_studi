<!DOCTYPE html>
<html lang="fr">
  {% include 'part/head.html' %}
  <body>
    {% include 'part/navbar.html' %}
    <div class="table-responsive">
      <div class="container mt-5">
        <h2>Liste des épreuves</h2>
        <table class="table table-striped table-bordered align-middle">
          <thead>
            <tr>
              <th>Date</th>
              <th>Heure</th>
              <th>Genre</th>
              <th>Lieu</th>
              <th>Discipline</th>
              <th>Compétition</th>
              <th>Tarif (€)</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for epreuve in epreuves %}
            <tr>
              <td>{{ epreuve.date }}</td>
              <td>{{ epreuve.heure }}</td>
              <td>{{ epreuve.genre }}</td>
              <td>{{ epreuve.lieu }}</td>
              <td>{{ epreuve.discipline }}</td>
              <td>{{ epreuve.competition }}</td>
              <td>{{ epreuve.tarif }}</td>
              
              <td class="d-flex gap-2 flex-wrap">
                <a href="{% url 'detail_epreuve' epreuve_id=epreuve.id %}" class="btn btn-primary btn-sm flex-fill">Détails de l'épreuve</a>
                <a href="{% url 'acheter_ticket' epreuve_id=epreuve.id %}" class="btn btn-success btn-sm flex-fill">Acheter un ticket</a>
                {% if user.is_staff %}
                  <a href="{% url 'editer_epreuve' epreuve.id %}" class="btn btn-warning btn-sm flex-fill">Modifier</a>
                  <form method="post" action="{% url 'supprimer_epreuve' epreuve.id %}">
                    {% csrf_token %}
                    <button type="submit" onclick="return confirm('Confirmez-vous la suppression ?')" class="btn btn-danger btn-sm flex-fill">Supprimer</button>
                  </form>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center">Aucune épreuve enregistrée</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <!-- Pagination -->
        <nav aria-label="Pagination">
          <ul class="pagination justify-content-center">
            {% if epreuves.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page={{ epreuves.previous_page_number }}">Précédent</a>
              </li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">Précédent</span></li>
            {% endif %}

            {% for num in epreuves.paginator.page_range %}
              {% if epreuves.number == num %}
                <li class="page-item active"><span class="page-link">{{ num }}</span></li>
              {% else %}
                <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
              {% endif %}
            {% endfor %}

            {% if epreuves.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ epreuves.next_page_number }}">Suivant</a>
              </li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">Suivant</span></li>
            {% endif %}
          </ul>
        </nav>
        
        <!-- Boutons de retour -->
        {% if user.is_staff %}
            <a href="{% url 'creer_epreuve' %}" class="btn btn-primary btn-sm">Créer une epreuve</a>
            <a href="{% url 'accueil' %}" class="btn btn-secondary btn-sm">⬅ Retour</a>
        {% endif %}
      </div>
    </div>

    {% include 'part/footer.html' %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>