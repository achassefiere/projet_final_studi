<!DOCTYPE html>
<html lang="fr">
    {% load widget_tweaks %}
    {% include 'part/head.html' %}
<body>
    {% include 'part/navbar.html' %}
    <main>
        <div class="card shadow-lg p-4" style="max-width: 420px; width: 100%;">
            <h2 class="text-center mb-4">Achat de tickets</h2>

            

            {% if already_bought %}
                <div class="alert alert-warning">
                    Vous avez déjà acheté des tickets pour cette épreuve.
                </div>
            {% else %}

            <!-- Infos épreuve -->
            <div class="mb-3">
                <p><strong>Épreuve :</strong> {{ epreuve.discipline }} - {{ epreuve.competition }}</p>
                <p><strong>Date :</strong> {{ epreuve.date }} | <strong>Heure :</strong> {{ epreuve.heure }}</p>
                <p><strong>Tarif :</strong> <span id="prix-unitaire">{{ epreuve.tarif }}</span> €</p>
            </div>

            <!-- Formulaire -->
            <form method="post" novalidate>
                {% csrf_token %}

                <div class="mb-3">
                    <label for="{{ form.quantite.id_for_label }}" class="form-label">{{ form.quantite.label }}</label>
                    {% render_field form.quantite class="form-select" id="quantite" %}
                    {% if form.quantite.errors %}
                        <div class="text-danger small mt-1">{{ form.quantite.errors|striptags }}</div>
                    {% endif %}
                </div>

                <p class="mt-2 fw-bold">Total : <span id="total">0</span> €</p>

                <button type="submit" class="btn btn-primary w-100">Acheter</button>
            </form>
             {% endif %}
             <a href="{% url 'liste_epreuves' %}" class="btn btn-secondary btn-sm">⬅ Retour</a>
        </div>
    </main>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Script pour mise à jour du total -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const quantiteSelect = document.getElementById("quantite");
            const totalSpan = document.getElementById("total");
            const prixUnitaire = parseFloat(document.getElementById("prix-unitaire").innerText);

            function updateTotal() {
                const quantite = parseInt(quantiteSelect.value);
                totalSpan.innerText = (quantite * prixUnitaire).toFixed(2);
            }

            quantiteSelect.addEventListener("change", updateTotal);
            updateTotal();
        });
    </script>
</body>
</html>